# Configuration for Cog ⚙️
# Reference: https://github.com/replicate/cog/blob/main/docs/yaml.md

image: "r8.im/fire/unirig"

build:
  cog_runtime: true
  
  gpu: true

  cuda: "12.6"
  
  system_packages:
    - "libegl1-mesa-dev"
    - "libgl1-mesa-dev"
    - "libglfw3-dev"
    - "libglew-dev"
    - "freeglut3-dev"
    - "libosmesa6-dev"
    - "xvfb"
    - "libglib2.0-0"
    - "libsm6"
    - "libxext6"
    - "libxrender-dev"
    - "libgomp1"
    - "wget"
    - "xz-utils"

  python_version: "3.10"

  python_requirements: requirements.txt

  run:
    - "wget -q https://download.blender.org/release/Blender4.5/blender-4.5.1-linux-x64.tar.xz -O /tmp/blender.tar.xz"
    - "tar -xf /tmp/blender.tar.xz -C /opt/"
    - "ln -s /opt/blender-4.5.1-linux-x64/blender /usr/local/bin/blender"
    - "export BLENDER_PATH=/opt/blender-4.5.1-linux-x64"
    - "export PATH=$BLENDER_PATH:$PATH"
    - "pip install spconv-cu126"
    - "pip install torch_scatter torch_cluster -f https://data.pyg.org/whl/torch-2.7.1+cu126.html --no-cache-dir"
    - "pip install flash-attn==2.7.4 --no-build-isolation"
    - "rm /tmp/blender.tar.xz"

predict: "predict.py:Predictor"
